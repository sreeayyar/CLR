%% Critical Value Function
% This code uses the criticalval function, and constructs a critical value
% function table named "cvf.tex" - this is Table 1 in the draft
% The final section creates Fig.1 in the draft, which is the CVF for k=4,
% plotted for different identification strengths tau

% Set the seed:
rng(1)

% Create the tables
fid = fopen('cvf_clr.tex', 'w'); 
fprintf(fid, '%s\n', '$\tau$ & $k=1$ & $k=2$  & $k=3$ & $k=4$ & $k=5$ & $k=10$ & $k=15$ & $k=20$ & $k=50$');
fprintf(fid, '%s\n','&&& size & size & size & size & size & size');
fprintf(fid, '%s\n', '\hline');
fprintf(fid, '%s\n', '\hline');
fclose(fid) ;
fid = fopen('cvf_mclr.tex', 'w'); 
fprintf(fid, '%s\n', '$\tau$ & $k=1$ & $k=2$  & $k=3$ & $k=4$ & $k=5$ & $k=10$ & $k=15$ & $k=20$ & $k=50$');
fprintf(fid, '%s\n','&&& size & size & size & size & size & size');
fprintf(fid, '%s\n', '\hline');
fprintf(fid, '%s\n', '\hline');
fclose(fid) ;

%% tau=1

[p_CLR11, p_mCLR11]=criticalval(100,2500,1,1);
[p_CLR12, p_mCLR12]=criticalval(100,2500,2,1);
[p_CLR13, p_mCLR13]=criticalval(100,2500,3,1);
[p_CLR14, p_mCLR14]=criticalval(100,2500,4,1);
[p_CLR15, p_mCLR15]=criticalval(100,2500,5,1);
[p_CLR16, p_mCLR16]=criticalval(100,2500,10,1);
[p_CLR17, p_mCLR17]=criticalval(100,2500,20,1);
[p_CLR18, p_mCLR18]=criticalval(100,2500,50,1);
fid = fopen('cvf_mclr.tex', 'a+'); 
fprintf(fid, ' %4.0f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f& %4.2f',...
    1,...
    mean(p_mCLR11),...
    mean(p_mCLR12),...
    mean(p_mCLR13),...
    mean(p_mCLR14),...
    mean(p_mCLR15),...
    mean(p_mCLR16),...
    mean(p_mCLR17),...
    mean(p_mCLR18));
fprintf(fid, '%s\n', '\hline');
fclose(fid);
fid = fopen('cvf_clr.tex', 'a+'); 
fprintf(fid, ' %4.0f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f& %4.2f',...
    1,...
    mean(p_CLR11),...
    mean(p_CLR12),...
    mean(p_CLR13),...
    mean(p_CLR14),...
    mean(p_CLR15),...
    mean(p_CLR16),...
    mean(p_CLR17),...
    mean(p_CLR18));
fprintf(fid, '%s\n', '\hline');
fclose(fid);

%% tau=5

[p_CLR21, p_mCLR21]=criticalval(100,2500,1,5);
[p_CLR22, p_mCLR22]=criticalval(100,2500,2,5);
[p_CLR23, p_mCLR23]=criticalval(100,2500,3,5);
[p_CLR24, p_mCLR24]=criticalval(100,2500,4,5);
[p_CLR25, p_mCLR25]=criticalval(100,2500,5,5);
[p_CLR26, p_mCLR26]=criticalval(100,2500,10,5);
[p_CLR27, p_mCLR27]=criticalval(100,2500,20,5);
[p_CLR28, p_mCLR28]=criticalval(100,2500,50,5);
fid = fopen('cvf_mclr.tex', 'a+'); 
fprintf(fid, ' %4.0f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f& %4.2f',...
    5,...
    mean(p_mCLR21),...
    mean(p_mCLR22),...
    mean(p_mCLR23),...
    mean(p_mCLR24),...
    mean(p_mCLR25),...
    mean(p_mCLR26),...
    mean(p_mCLR27),...
    mean(p_mCLR28));
fprintf(fid, '%s\n', '\hline');
fclose(fid);
fid = fopen('cvf_clr.tex', 'a+'); 
fprintf(fid, ' %4.0f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f& %4.2f',...
    5,...
    mean(p_CLR21),...
    mean(p_CLR22),...
    mean(p_CLR23),...
    mean(p_CLR24),...
    mean(p_CLR25),...
    mean(p_CLR26),...
    mean(p_CLR27),...
    mean(p_CLR28));
fprintf(fid, '%s\n', '\hline');
fclose(fid);

%% tau=10

[p_CLR31, p_mCLR31]=criticalval(100,2500,1,10);
[p_CLR32, p_mCLR32]=criticalval(100,2500,2,10);
[p_CLR33, p_mCLR33]=criticalval(100,2500,3,10);
[p_CLR34, p_mCLR34]=criticalval(100,2500,4,10);
[p_CLR35, p_mCLR35]=criticalval(100,2500,5,10);
[p_CLR36, p_mCLR36]=criticalval(100,2500,10,10);
[p_CLR37, p_mCLR37]=criticalval(100,2500,20,10);
[p_CLR38, p_mCLR38]=criticalval(100,2500,50,10);
fid = fopen('cvf_mclr.tex', 'a+'); 
fprintf(fid, ' %4.0f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f& %4.2f',...
    10,...
    mean(p_mCLR31),...
    mean(p_mCLR32),...
    mean(p_mCLR33),...
    mean(p_mCLR34),...
    mean(p_mCLR35),...
    mean(p_mCLR36),...
    mean(p_mCLR37),...
    mean(p_mCLR38));
fprintf(fid, '%s\n', '\hline');
fclose(fid);
fid = fopen('cvf_clr.tex', 'a+'); 
fprintf(fid, ' %4.0f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f& %4.2f',...
    10,...
    mean(p_CLR31),...
    mean(p_CLR32),...
    mean(p_CLR33),...
    mean(p_CLR34),...
    mean(p_CLR35),...
    mean(p_CLR36),...
    mean(p_CLR37),...
    mean(p_CLR38));
fprintf(fid, '%s\n', '\hline');
fclose(fid);

%% tau=20

[p_CLR41, p_mCLR41]=criticalval(100,2500,1,20);
[p_CLR42, p_mCLR42]=criticalval(100,2500,2,20);
[p_CLR43, p_mCLR43]=criticalval(100,2500,3,20);
[p_CLR44, p_mCLR44]=criticalval(100,2500,4,20);
[p_CLR45, p_mCLR45]=criticalval(100,2500,5,20);
[p_CLR46, p_mCLR46]=criticalval(100,2500,10,20);
[p_CLR47, p_mCLR47]=criticalval(100,2500,20,20);
[p_CLR48, p_mCLR48]=criticalval(100,2500,50,20);

fid = fopen('cvf_mclr.tex', 'a+'); 
fprintf(fid, ' %4.0f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f& %4.2f',...
    20,...
    mean(p_mCLR41),...
    mean(p_mCLR42),...
    mean(p_mCLR43),...
    mean(p_mCLR44),...
    mean(p_mCLR45),...
    mean(p_mCLR46),...
    mean(p_mCLR47),...
    mean(p_mCLR48));
fprintf(fid, '%s\n', '\hline');
fclose(fid);
fid = fopen('cvf_clr.tex', 'a+'); 
fprintf(fid, ' %4.0f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f& %4.2f',...
    20,...
    mean(p_CLR41),...
    mean(p_CLR42),...
    mean(p_CLR43),...
    mean(p_CLR44),...
    mean(p_CLR45),...
    mean(p_CLR46),...
    mean(p_CLR47),...
    mean(p_CLR48));
fprintf(fid, '%s\n', '\hline');
fclose(fid);

%% tau=50

[p_CLR51, p_mCLR51]=criticalval(100,2500,1,50);
[p_CLR52, p_mCLR52]=criticalval(100,2500,2,50);
[p_CLR53, p_mCLR53]=criticalval(100,2500,3,50);
[p_CLR54, p_mCLR54]=criticalval(100,2500,4,50);
[p_CLR55, p_mCLR55]=criticalval(100,2500,5,50);
[p_CLR56, p_mCLR56]=criticalval(100,2500,10,50);
[p_CLR57, p_mCLR57]=criticalval(100,2500,20,50);
[p_CLR58, p_mCLR58]=criticalval(100,2500,50,50);
fid = fopen('cvf_mclr.tex', 'a+'); 
fprintf(fid, ' %4.0f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f& %4.2f',...
    50,...
    mean(p_mCLR51),...
    mean(p_mCLR52),...
    mean(p_mCLR53),...
    mean(p_mCLR54),...
    mean(p_mCLR55),...
    mean(p_mCLR56),...
    mean(p_mCLR57),...
    mean(p_mCLR58));
fprintf(fid, '%s\n', '\hline');
fclose(fid);
fid = fopen('cvf_clr.tex', 'a+'); 
fprintf(fid, ' %4.0f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f& %4.2f',...
    50,...
    mean(p_CLR51),...
    mean(p_CLR52),...
    mean(p_CLR53),...
    mean(p_CLR54),...
    mean(p_CLR55),...
    mean(p_CLR56),...
    mean(p_CLR57),...
    mean(p_CLR58));
fprintf(fid, '%s\n', '\hline');
fclose(fid);

%% tau=75

[p_CLR61, p_mCLR61]=criticalval(100,2500,1,75);
[p_CLR62, p_mCLR62]=criticalval(100,2500,2,75);
[p_CLR63, p_mCLR63]=criticalval(100,2500,3,75);
[p_CLR64, p_mCLR64]=criticalval(100,2500,4,75);
[p_CLR65, p_mCLR65]=criticalval(100,2500,5,75);
[p_CLR66, p_mCLR66]=criticalval(100,2500,10,75);
[p_CLR67, p_mCLR67]=criticalval(100,2500,20,75);
[p_CLR68, p_mCLR68]=criticalval(100,2500,50,75);
fid = fopen('cvf_mclr.tex', 'a+'); 
fprintf(fid, ' %4.0f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f& %4.2f',...
    75,...
    mean(p_mCLR61),...
    mean(p_mCLR62),...
    mean(p_mCLR63),...
    mean(p_mCLR64),...
    mean(p_mCLR65),...
    mean(p_mCLR66),...
    mean(p_mCLR67),...
    mean(p_mCLR68));
fprintf(fid, '%s\n', '\hline');
fclose(fid);
fid = fopen('cvf_clr.tex', 'a+'); 
fprintf(fid, ' %4.0f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f& %4.2f',...
    75,...
    mean(p_CLR61),...
    mean(p_CLR62),...
    mean(p_CLR63),...
    mean(p_CLR64),...
    mean(p_CLR65),...
    mean(p_CLR66),...
    mean(p_CLR67),...
    mean(p_CLR68));
fprintf(fid, '%s\n', '\hline');
fclose(fid);

%% tau=100

[p_CLR71, p_mCLR71]=criticalval(100,2500,1,100);
[p_CLR72, p_mCLR72]=criticalval(100,2500,2,100);
[p_CLR73, p_mCLR73]=criticalval(100,2500,3,100);
[p_CLR74, p_mCLR74]=criticalval(100,2500,4,100);
[p_CLR75, p_mCLR75]=criticalval(100,2500,5,100);
[p_CLR76, p_mCLR76]=criticalval(100,2500,10,100);
[p_CLR77, p_mCLR77]=criticalval(100,2500,20,100);
[p_CLR78, p_mCLR78]=criticalval(100,2500,50,100);
fid = fopen('cvf_mclr.tex', 'a+'); 
fprintf(fid, ' %4.0f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f& %4.2f',...
    100,...
    mean(p_mCLR71),...
    mean(p_mCLR72),...
    mean(p_mCLR73),...
    mean(p_mCLR74),...
    mean(p_mCLR75),...
    mean(p_mCLR76),...
    mean(p_mCLR77),...
    mean(p_mCLR78));
fprintf(fid, '%s\n', '\hline');
fclose(fid);
fid = fopen('cvf_clr.tex', 'a+'); 
fprintf(fid, ' %4.0f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f& %4.2f',...
    100,...
    mean(p_CLR71),...
    mean(p_CLR72),...
    mean(p_CLR73),...
    mean(p_CLR74),...
    mean(p_CLR75),...
    mean(p_CLR76),...
    mean(p_CLR77),...
    mean(p_CLR78));
fprintf(fid, '%s\n', '\hline');
fclose(fid);

%% tau=50000

[p_CLR81, p_mCLR81]=criticalval(100,2500,1,50000);
[p_CLR82, p_mCLR82]=criticalval(100,2500,2,50000);
[p_CLR83, p_mCLR83]=criticalval(100,2500,3,50000);
[p_CLR84, p_mCLR84]=criticalval(100,2500,4,50000);
[p_CLR85, p_mCLR85]=criticalval(100,2500,5,50000);
[p_CLR86, p_mCLR86]=criticalval(100,2500,10,50000);
[p_CLR87, p_mCLR87]=criticalval(100,2500,20,50000);
[p_CLR88, p_mCLR88]=criticalval(100,2500,50,50000);
fid = fopen('cvf_mclr.tex', 'a+'); 
fprintf(fid, ' %4.0f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f& %4.2f',...
    50000,...
    mean(p_mCLR81),...
    mean(p_mCLR82),...
    mean(p_mCLR83),...
    mean(p_mCLR84),...
    mean(p_mCLR75),...
    mean(p_mCLR86),...
    mean(p_mCLR87),...
    mean(p_mCLR88));
fprintf(fid, '%s\n', '\hline');
fclose(fid);
fid = fopen('cvf_clr.tex', 'a+'); 
fprintf(fid, ' %4.0f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f & %4.2f& %4.2f',...
    50000,...
    mean(p_CLR81),...
    mean(p_CLR82),...
    mean(p_CLR83),...
    mean(p_CLR84),...
    mean(p_CLR75),...
    mean(p_CLR86),...
    mean(p_CLR87),...
    mean(p_CLR88));
fprintf(fid, '%s\n', '\hline');
fclose(fid);

%% figure for CVF: k=4

p_mCLR9 = zeros(15,0);
p_mCLR9(1) = criticalval(100,2500,4,0);
p_mCLR9(2) = criticalval(100,2500,4,1);
p_mCLR9(3) = criticalval(100,2500,4,2);
p_mCLR9(4) = criticalval(100,2500,4,3);
p_mCLR9(5) = criticalval(100,2500,4,4);
p_mCLR9(6) = criticalval(100,2500,4,5);
p_mCLR9(7) = criticalval(100,2500,4,6);
p_mCLR9(8) = criticalval(100,2500,4,7);
p_mCLR9(9) = criticalval(100,2500,4,8);
p_mCLR9(10) = criticalval(100,2500,4,9);
p_mCLR9(11) = criticalval(100,2500,4,10);
p_mCLR9(12) = criticalval(100,2500,4,15);
p_mCLR9(13) = criticalval(100,2500,4,20);
p_mCLR9(14) = criticalval(100,2500,4,25);
p_mCLR9(15) = criticalval(100,2500,4,30);

grid_points=11;

lower_bound= 0 ;
upper_bound= 10;
grid=lower_bound(1):1:upper_bound(1);
grid(:,end+1) = 15;
grid(:,end+1) = 20;
grid(:,end+1) = 25;
grid(:,end+1) = 30;

fig = figure(1);
grid_plot = grid;
plot(grid_plot',p_mCLR9,'*-','LineWidth',1)
yline(9.4805,'.-.');
yline(3.94,'--');

legend('Critical Value Function','Upper Bound','Lower Bound','FontSize',12);
xlabel('\bf \tau','FontSize',12); xlim([min(0) max(grid_plot)])
ylabel('Critical Value','FontSize',12);
ylim([0 10])